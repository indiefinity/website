const c=document.getElementById("canvas"),g=c.getContext("2d"),c2=document.getElementById("pipes"),g2=c2.getContext("2d"),c3=document.getElementById("bg"),bg=c3.getContext("2d");var bird,highscore=getCookie("highscore"),failed=!1,score=0,img=new Image;img.onload=function(){bird=img},img.src="./bird.png",console.log("start!"),pipe();var char={x:100,y:200},main=setInterval(function(){c.width=c.width,bg.fillStyle="#8fddff",bg.fillRect(0,0,canvas.width,canvas.height),g.fillStyle="#000000",g.drawImage(bird,char.x,c.height-char.y),g.fillStyle="#40b320",g.fillRect(0,550,c.width,50),document.getElementById("score").innerHTML=Math.floor(score/6)+" (Highscore: "+highscore+")"},10),timer2=setInterval(function(){pipe()},1e3),gravity=setInterval(function(){char.y<100&&(char.y=100),char.y>100&&(char.y*=.98)},10);function doKeyDown(e){switch(e.keyCode){case 32:jump();break;case 65:console.log("a"),char.x-=2;break;case 68:console.log("d"),char.x+=20}}function jump(){failed&&(window.location=window.location);let e=10;var c=setInterval(function(){char.y+=e,(e*=.96)<.1&&clearInterval(c)},10)}function pipe(){if(0==r(0,1)){let e={x:860,y:r(100,450)},a=setInterval(function(){c2.width=c2.width,g2.fillStyle="#0d7a23",g2.fillRect(e.x,0,80,c.height),g2.clearRect(e.x,c2.height-e.y,80,-150),char.x>e.x&&char.x<e.x+50&&char.y>e.y+150&&fail(),char.x>e.x&&char.x<e.x+50&&char.y<e.y&&fail(),char.x>e.x&&char.x<e.x+50&&char.y-10>e.y+150&&fail(),char.x>e.x&&char.x<e.x+50&&char.y-10<e.y&&fail(),char.x-10>e.x&&char.x-10<e.x+50&&char.y>e.y+150&&fail(),char.x-10>e.x&&char.x-10<e.x+50&&char.y<e.y&&fail(),char.x-10>e.x&&char.x-10<e.x+50&&char.y-10>e.y+150&&fail(),char.x-10>e.x&&char.x-10<e.x+50&&char.y-10<e.y&&fail(),char.x>e.x&&char.x<e.x+50&&score++,e.x-=8,e.x<0&&clearInterval(a)},10)}else{let e={x:860,y:r(100,452)},a=!0,t=setInterval(function(){switch(c2.width=c2.width,g2.fillStyle="#0d7a23",g2.fillRect(e.x,0,80,c.height),g2.clearRect(e.x,c2.height-e.y,80,-150),e.y<104&&(e.y=100,a=!1),e.y>448&&(e.y=452,a=!0),a){case!0:e.y-=4;break;case!1:e.y+=4}char.x>e.x&&char.x<e.x+50&&char.y>e.y+150&&fail(),char.x>e.x&&char.x<e.x+50&&char.y<e.y&&fail(),char.x>e.x&&char.x<e.x+50&&char.y-10>e.y+150&&fail(),char.x>e.x&&char.x<e.x+50&&char.y-10<e.y&&fail(),char.x-10>e.x&&char.x-10<e.x+50&&char.y>e.y+150&&fail(),char.x-10>e.x&&char.x-10<e.x+50&&char.y<e.y&&fail(),char.x-10>e.x&&char.x-10<e.x+50&&char.y-10>e.y+150&&fail(),char.x-10>e.x&&char.x-10<e.x+50&&char.y-10<e.y&&fail(),char.x>e.x&&char.x<e.x+50&&score++,e.x-=8,e.x<0&&clearInterval(t)},10)}}function r(e,c){return e=Math.ceil(e),c=Math.floor(c),Math.floor(Math.random()*(c-e+1))+e}function fail(){clearInterval(main),clearInterval(gravity),clearInterval(pipes),clearInterval(timer2),c.width=c.width,c2.width=c2.width,g.fillStyle="red",g.fillRect(0,0,c.width,c.height),failed=!0,Math.floor(score/6)>highscore&&setCookie("highscore",Math.floor(score/6-.5),9999)}function getCookie(e){for(var c=e+"=",a=decodeURIComponent(document.cookie).split(";"),r=0;r<a.length;r++){for(var t=a[r];" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(c))return t.substring(c.length,t.length)}return""}function setCookie(e,c,a){var r=new Date;r.setTime(r.getTime()+24*a*60*60*1e3);var t="expires="+r.toUTCString();document.cookie=e+"="+c+";"+t+";path=/"}window.addEventListener("keypress",doKeyDown,!1),c.addEventListener("keydown",doKeyDown,!0);
